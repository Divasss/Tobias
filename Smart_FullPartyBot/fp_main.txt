(*

  Git Version


	Thoughts on Duo Party 
		When should bishops Rez?
			- When both healers are dead from other pt, rez a healer
			
		When should bishops Mass Rez?
			- When more than 7 friends are dead
			
		
		Allow Aoe?
		
		AutoGladi
		AutoTitan
		AutoDoombringer
		AutoDagger
		AutoJudi
		AutoSk
		
			
			
	



	1.1	Added Warlord Charge to Aoe point

	To Add: 	Specific OL Skills, 
				Ignore Targets on UD or cele,
				nvm - Make Warlords pick non stunned targets, when making cluster calculations

				Sell All Items

*)
uses 
SysUtils, Classes, global_vars, fp_inc, fp_target_inc, fp_char_info, fp_actions_inc;

procedure AutoWarlord;
var
ma : Tl2Char;
debug: Boolean;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Warlord Started.');
	debug := false;
	while true do begin
		Delay(300);
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		if debug then print('Warlord check nearby players');
		PlayersNearby := IsOtherPlayersNearby(3000);
		if debug then print('Set party Center');
		SetPoint_PartyCenter;
		if debug then print('Set Pvp stance');
		SetPvpStance;
		
		if debug then print('Discrete or players nearby?');
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
		if debug then print('Check Distance to party center, and move accordnigly');
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		if debug then print('Check if we are under attack');
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			
			if CheckUse_HeroSelfBuffs then continue;
			
			if debug then print('We are under attack, set point aoe position');
			SetPoint_AoePosition;
			
			if debug then print('Check if it is time to Aoe, and if point is valid');
			//	time to aoe?
			if (IsTime_ToAoe) and (IsAoePoint_Valid) then begin
				
				if debug then print('It is time to Aoe, set distance to aoe point');
				SetDistance_AoePointDistance;
								
				if debug then print('Check for PVP or PVE');
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					
					if debug then print('PVP Mode - check cluster charge');
					//AOE Pvp				
					if (Check_ClusterCharge_Pvp) then Continue;
					
					if debug then print('PVP Mode - Check aoe point dist');
					if (AOE_PT_DIST > 150) then begin
						MoveTo_AoePoint; Continue; end;

					if debug then print('PVP Mode - Close to aoe point, start attacking');
					if (SetTarget_Nearest_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if debug then print('PVE Mode - check cluster charge');
					if (Check_ClusterCharge_Pve) then continue;
					
					if debug then print('PVE Mode - Check aoe point dist');
					if (AOE_PT_DIST > 150) then begin
						MoveTo_AoePoint; Continue; end;

					if debug then print('PVE Mode - Close to aoe point, start attacking');
					if (SetTarget_Nearest_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
				
				if debug then print('It is NOT time to Aoe, check if PVP or PVE');
				if (PvpLoaded) then begin
				
					if debug then print('PVP Mode: Check if main assist has valid target');
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then 
						continue;
						
				end else begin
					if debug then print('PVE Mode: select nearest valid target');
					//Singe Target Pve
					
					if SetTarget_NearestAgroed_Pve then
						Continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
			
			if debug then print('Check move deadParty');
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		if debug then print('Last Action.. Auto Follow someone');
		AutoFollow();
	end;
end;


procedure AutoOverlord;
var
ma : Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Overlord Started.');
	
	while true do begin
		Delay(300);
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			if CheckUse_HeroSelfBuffs then continue;
			SetPoint_AoePosition;
			(*
			// If Seal of Despair / Blockade and others are on cd, find mage cluster and spam silence
			if not(HasSkills_Ready_Any(despair, blockade, whatever)) then begin
				if (GetCount_ClusteredMages_Pvp > 2) then begin
					
					made procedures:
					GetTarget_MostClustered_Char_MagesOnly
					GetCount_ClusteredMages_Pvp
					GetPoint_AoePosition_Pvp_ClusteredMages
					
				end;
			end;
			*)
			//	time to aoe?
			if (IsTime_ToAoe) and (IsAoePoint_Valid) then begin
				SetDistance_AoePointDistance;
				
				if (AOE_PT_DIST > 150) then begin
					MoveTo_AoePoint; 
					Continue; 
				end;
				//Check use seal of silence...
				if (HasSkill_Ready(1246)) and HasSkill_Ready_Interval(1246, 5000) then begin
					if (GetCount_MagesClustered_NearChar_Pvp(User, 300) > 1) then begin
						//if HasSkill_Ready_Interval(1246, 5000) then //Skill ID = 1246, Interval = 5000
						UseSkill_SetInterval(1246, 5000);
					end;
				end;
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					//AOE Pvp
					if (SetTarget_Nearest_Pvp) then begin
						UseSkill_Ol_AoeAttack_Pvp;
						Continue;
					end;
				end else begin
					//AOE PVE
					if (SetTarget_Nearest_Pve) then begin
						Continue;
					end;
				end;
			
			//	if not aoe, then we single target!
			end else begin
			
				if (PvpLoaded) then begin
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
					//Singe Target Pve
					if (SetTarget_NearestAgroed_Pve) then
						Continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;


procedure AutoTank;
var
ma : Tl2Char;
AgroMode, TargetFound: Boolean;
circleRoundNum: Integer;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Tank Started.');
	AgroMode := false;
	circleRoundNum := 1;
	
	while true do begin
		Delay(400);
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		CheckDispellBuffs([915, 1261]); //zerk dance, paagrio zerk
		
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		TargetFound := false;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
	
		//Handle Circle agro mode
		if (CircleAgroMode) then begin
			ma := GetTarget_MainAssist;
			Action_CircleAgroMove(circleRoundNum, ma);
			Inc(circleRoundNum);
		end else if (circleRoundNum > 1) then //Initialize movement pattern, if mode is suddenly off
			circleRoundNum := 1;
	
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		if CombatEnabled then begin
			if CheckUse_Tank_Overall_Buff then continue;
		end;
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			
			
			//	Pvp Combat
			if (PvpLoaded) then begin
				if CheckUse_HeroSelfBuffs then continue;
				
				CheckUse_HeroicValor_LeaderOnly;
				
				if (CheckUse_Tank_Pvp_Buff) then continue;
				
				if (CheckUse_InsaneCrusher) then continue; //Hell Knights only
				
				if (SetTarget_ToAgro_Pvp) then begin
					AgroMode := true;
					TargetFound := true;
				
				end else if (SetTarget_Best_Pvp) then begin
					AgroMode := false;
					TargetFound := true;
				
				end else
					TargetFound := false;
				
				if (TargetFound) then begin
				
					if AgroMode and HasSkills_Ready_Any(18, 28, 985)	
					and UseSkill_Tank_Agro_Pvp then begin
						Continue;
						
					end else if CheckUse_Tank_MiscPvp_Skills() then begin
						continue;
					
					end else if HasSkills_Ready_Any(984, 92, 342, 353, 401, 403, 352)
					and UseSkill_Tank_Attack_Pvp then begin
						Continue;
					end else if Engine.Attack(50) then
						Continue;
				
				end else if CheckUse_Tank_MiscPvp_Skills() then 
					continue;
					
			//	Pve Combat
			end else begin
				
				if CheckUse_Tank_Pve_Buff then continue;
				
				if CheckUse_InsaneCrusher then continue;
				
				if (SetTarget_ToAgro_Pve) then begin
					AgroMode := true;
					TargetFound := true;
				
				end else if (SetTarget_NearestAgroed_Pve) then begin
					AgroMode := false;
					TargetFound := true;
				
				end else
					TargetFound := false;
					
				
				if (TargetFound) then begin
				
					if AgroMode and HasSkills_Ready_Any(18, 28, 985) and (User.Mp > 10) 
					and UseSkill_Tank_Agro_Pve then begin
						Continue;
					end else if HasSkills_Ready_Any(984, 92, 401, 400, 352) and (User.Mp > 10)
					and UseSkill_Tank_Attack_Pve then begin
						Continue;
					end else if Engine.Attack(50) then 
						Continue;
					
				end;
			
			end;

			
		//Non Combat Related
		end else begin
		
			//	If anyone is dead, and we are not in combat,
			//	go to them, so the healers will get close and auto rez.
			if (CheckMove_DeadParty_LeaderOnly) then Continue;
			
			
		end;
		AutoFollow();
		
		if (User.Name = GetName_LocalLeader) then 
			CheckFindNewMob;
	end;
	
		(*
	  MassAgro := GeneralFunctions.LoadSkill(18); //SkillList.ByID(18, MassAgro);
	  Agro := GeneralFunctions.LoadSkill(28); //SkillList.ByID(28, Agro);
	  FateChal := GeneralFunctions.LoadSkill(985); //SkillList.ByID(985, FateChal);
	  ShieldAgro := GeneralFunctions.LoadSkill(984); //SkillList.ByID(984, ShieldAgro);
	  Stun := GeneralFunctions.LoadSkill(92); //SkillList.ByID(92, Stun);
	  ToD := GeneralFunctions.LoadSkill(342); //SkillList.ByID(342, ToD);
	  ShieldSlam := GeneralFunctions.LoadSkill(353); //SkillList.ByID(353, ShieldSlam);
	  Judgement := GeneralFunctions.LoadSkill(401); //SkillList.ByID(401, Judgement);
	  Shackle := GeneralFunctions.LoadSkill(403); //SkillList.ByID(403, Shackle);
	  SoF := GeneralFunctions.LoadSkill(528); //SkillList.ByID(528, SoF);
	  InsaneCrusher := GeneralFunctions.LoadSkill(762); //SkillList.ByID(762, InsaneCrusher);
	  HellScream := GeneralFunctions.LoadSkill(763); //SkillList.ByID(763, HellScream);


*)	
	
end;


procedure AutoBishop;
var
ma : Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Bishop Started.');
	while true do begin
			Delay(500);
		CheckRemove_BuffsByList;
		CheckDispellBuffs([789]); //Spirit of Shilen
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		if CombatEnabled then begin
			Check_LowHpMode_Actions;
		end;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
		
		//Healing Related
		if (IsTime_ToHeal) then begin
			if CheckUse_HeroSelfBuffs then continue;
			
			//	Mass Resurection?
			if HasSkill_Ready(1254) 
			and (IsTime_ToMassRez) then begin
				CUseSkill(1254, false, false, Engine.GetFaceState(0));
				Continue;
			end;
			
			//	Resurection?
			if HasSkill_Ready(1016) then begin
				if (SetTarget_Rez_v2) then begin
					Engine.Say('Rezzing ' + User.Target.Name, 3, '');
					CUseSkill(1016, false, false, Engine.GetFaceState(0));
					Continue;
				end else if (SetTarget_Rez_Friends) then begin
					Engine.Say('Rezzing other pt: ' + User.Target.Name, 3, '');
					CUseSkill(1016, false, false, Engine.GetFaceState(0));
					Continue;
				end;
			end;
			
			//	Balance Life?
			if HasSkill_Ready(1335) 
			and not LowHpMode
			and (IsTime_ToBalanceLife) then begin
				CUseSkill(1335, false, false, Engine.GetFaceState(0));
				Continue;
			end;
			
			//	Cleanse?
			if HasSkill_Ready(1409)
			and HasItem_MinCount(Engine, 8874, 1)
			and (SetTarget_Cleanse_v2) then begin
				Engine.Say('Cleansing ' + User.Target.Name, 3, '');
				CUseSkill(1409, false, false, Engine.GetFaceState(0));
				Continue;
			end;
			
			//	Major Group Heal?
			if not PvpLoaded 		//Disable for pvp
			and not LowHpMode
			and HasSkill_Ready(1402) and not HasSkill_Ready(1553)
			and (IsTime_ToMajorGroupHeal) then begin
				CUseSkill(1402, false, false, Engine.GetFaceState(0));
				Continue;
			end;
		
		//If we do not need to heal
		end else if IsUnderAttack and CombatEnabled then begin
			
		
			//What to do in Pvp if not healing?
			if (PvpLoaded) then begin
				if CheckUse_HeroSelfBuffs then continue;
				
				if (HasSkill_Ready(1394)) 
				and (SetTarget_BestCC_Pvp) then begin
					if not (IsTarget_Slept(User.Target)) then begin
						Engine.UseSkill(1394);
						Continue;
					end;
				end;
			
			end else begin
				
				//Pve, nothing atm
				
			end;
		end else begin
			//Non Combat/Heal Related
			
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
		end;
			
		AutoFollow();	
	end;
end;

procedure AutoElvenElder;
var
ma : Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Elven Elder Started.');
	while true do begin
			Delay(500);
		CheckRemove_BuffsByList;
		CheckDispellBuffs([789]); //Spirit of Shilen
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
		
		//Healing Related
		if (IsTime_ToHeal_Ee) then begin
			if CheckUse_HeroSelfBuffs then continue;
			
			//	Resurection?
			if HasSkill_Ready(1016) then begin
				if (SetTarget_Rez_v2) then begin
					Engine.Say('Rezzing ' + User.Target.Name, 3, '');
					CUseSkill(1016, false, false, Engine.GetFaceState(0));
					Continue;
				end else if (SetTarget_Rez_Friends) then begin
					Engine.Say('Rezzing other pt: ' + User.Target.Name, 3, '');
					CUseSkill(1016, false, false, Engine.GetFaceState(0));
					Continue;
				end;
			end;
			
			//	Major Group Heal?
			if HasSkill_Ready(1402)
			and (IsTime_ToMajorGroupHeal) then begin
				Engine.FaceControl(0, false);
				Engine.UseSkill(1402);
				Engine.FaceControl(0, true);
				Continue;
			end;
		//If we do not need to heal
		end else if IsUnderAttack and CombatEnabled then begin
		
			//What to do in Pvp if not healing?
			if (PvpLoaded) then begin
				if CheckUse_HeroSelfBuffs then continue;
				
				if (HasSkill_Ready(1394)) 
				and (SetTarget_BestCC_Pvp) then begin
					if not (IsTarget_Slept(User.Target)) then begin
						Engine.UseSkill(1394);
						Continue;
					end;
				end;
			
				//Check Block WW
			
			end else begin
				
				//Pve, nothing atm
				
			end;
		end else begin
			//Non Combat/Heal Related
			
			if CheckMove_DeadParty_LeaderOnly() then continue;
		
		end;
		
		AutoFollow();	
	end;
end;

procedure AutoNuker;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Nuker Started.');
	while true do begin
		Delay(400);	
		CheckRemove_BuffsByList;	
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			
			if Action_CheckForCombatInitiation then continue;
			
			//	time to aoe?		//Dont allow nukers to aoe in pvp.
			if (IsTime_ToAoe) and not PvpLoaded then begin
								
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					if CheckUse_HeroSelfBuffs then continue;
				
					//AOE Pvp
					if (SetTarget_MostClustered_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
			
				if (PvpLoaded) then begin
					if CheckUse_HeroSelfBuffs then continue;
				
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
						
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
		
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;


procedure AutoSoulHound;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Soulhound Started.');
	while true do begin
		Delay(400);
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		
		
		if DoActions or TotalPause or (User.Dead) then begin
			CheckBuffs_L2Idle;
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		if CheckBuffs_L2Idle then continue;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			if CheckUse_HeroSelfBuffs then continue;
			
			SetPoint_AoePosition;
			if Action_CheckForCombatInitiation then continue;
			
			//Attacks regardless of Aoe status
			if (PvpLoaded) then begin
			
				//Check main assist's target for death mark
				if HasSkill_Ready_Interval(1435, 2500) then begin
					ma := GetTarget_MainAssist;
					oLiveTarget := ma.Target;
					if not (ma = nil)
					and not (ma = user)
					and not (oLiveTarget = nil)
					and IsTarget_Valid_CharAsLive(oLiveTarget)
					and not IsTarget_DeathMarked(oLiveTarget) then begin
						Engine.CancelTarget();
						Engine.SetTarget(oLiveTarget);
						UseSkill_SetInterval(1435, 2500);
						Continue;
					end;
				end;
			
				//Check use Voice Bind...
				if HasSkill_Ready_Interval(1447, 5000) then begin
					if (SetTarget_BestToSilence_Pvp(450)) then begin
						UseSkill_SetInterval(1447, 5000);
					end;
				end;
				//Check use Shadow Bind...
				if HasSkill_Ready_Interval(1447, 5000) then begin
					if (SetTarget_BestToRoot_Pvp(450)) then begin
						UseSkill_SetInterval(1447, 5000);
					end;
				end;
			end;
			
			//	time to aoe?
			if (IsTime_ToAoe) and (IsAoePoint_Valid) then begin
				Print('Time to Aoe!');
				SetDistance_AoePointDistance;
				
				if PvpLoaded then begin
					if Check_ClusterCharge_Pvp then continue;
				end else begin
					if (Check_ClusterCharge_Pve) then continue;
				end;
				
				
				if (AOE_PT_DIST > 150) then begin
					MoveTo_AoePoint; 
					Continue; 
				end;
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					//AOE Pvp
					if (SetTarget_Nearest_Pvp) then begin
						UseSkill_Slh_AoeAttack_Pvp;
						Continue;
					end;
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then begin
						UseSkill_Slh_AoeAttack_Pve;
						Continue;
					end;
				end;
			
			//	if not aoe, then we single target!
			end else begin
					
			
				if (PvpLoaded) then begin
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
				
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;


procedure AutoOffTank_SwsBd;
var
ma, deadMember : Tl2Char;
AgroMode, TargetFound: Boolean;
circleRoundNum: Integer;
begin
	Print('Auto Tank Started.');
	AgroMode := false;
	circleRoundNum := 1;
	
	while true do begin
		Delay(250);
		
		VoiceCommand_Listen;
		
		
		if DoActions or TotalPause or (User.Dead) then begin
			Print('We are total paused');
			Continue;
		end;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		TargetFound := false;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
	
		//Handle Circle agro mode
		if (CircleAgroMode) then begin
			ma := GetTarget_MainAssist;
			Action_CircleAgroMove(circleRoundNum, ma);
			Inc(circleRoundNum);
		end else if (circleRoundNum > 1) then //Initialize movement pattern, if mode is suddenly off
			circleRoundNum := 1;
	
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			if CheckUse_HeroSelfBuffs then continue;
			
			//	Pvp Combat
			if (PvpLoaded) then begin
				
				if (ShouldIAgro and SetTarget_ToAgro_Pvp) then begin
					AgroMode := true;
					TargetFound := true;
				
				end else if (SetTarget_Best_Pvp) then begin
					AgroMode := false;
					TargetFound := true;
				
				end else
					TargetFound := false;
				
				if (TargetFound) then begin
				
					if AgroMode and HasSkills_Ready_Any(28) then begin
						if UseSkill_Aggression_Pvp then Continue;
					end else begin
						if not CheckSwsBd_Aoe then
							Engine.Attack(1000, true);
					end;
					
					//if not AgroMode and HasSkills_Ready_Any(984, 92, 342, 353, 401, 403) then begin
						//if UseSkill_Hk_Attack_Pvp then Continue;
					//end;
				
				end;
			//	Pve Combat
			end else begin
				
				
				if (ShouldIAgro and SetTarget_ToAgro_Pve) then begin
					AgroMode := true;
					TargetFound := true;
				
				end else if (SetTarget_NearestAgroed_Pve) then begin
					AgroMode := false;
					TargetFound := true;
				
				end else
					TargetFound := false;
					
				
				if (TargetFound) then begin
					if AgroMode and HasSkills_Ready_Any(28) then begin
						if UseSkill_Aggression_Pve then Continue;
					end else begin
						if not CheckSwsBd_Aoe then
							Engine.Attack(1000, true);
					end;
					
				end;
			
			end;

			
		//Non Combat Related
		end else begin
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
		end;
		
		AutoFollow();
	end;
end;



procedure AutoArcher;
var
ma : Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Archer Started.');
	while true do begin
		Delay(400);
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			//SetPoint_AoePosition;
			if CheckUse_HeroSelfBuffs then continue;
			if Action_CheckForCombatInitiation then continue;
			
			//single target!
			
			if (PvpLoaded) then begin
				//Single Target Pvp
				if SetTarget_MainAssist then 
					continue
				else if SetTarget_Best_Pvp then
					continue;
						
			end else begin
				//Singe Target Pve
				if SetTarget_MainAssist then 
					continue
				else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
					continue
				else if SetTarget_NearestAgroed_Pve then
					continue;						
			end;
						
		//Non Combat Related
		end else begin
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;

procedure AutoSummoner;
var
ma, oTargetToFollow : Tl2Char;
counter: Integer;
setPet: Boolean;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Summoner Started.');
	counter := 0;
	while true do begin
		Delay(300);
		
		counter := counter + 1;
		if (counter mod 3 = 0) then begin
			setPet := true;
			counter := 0;
		end else begin
			setPet := false;
		end;
		
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		//SetPoint_PartyCenter;
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
		if CombatEnabled and AA_BringMobsMode then begin
			if (setPet) then PullMobs_CleanList;
			if Action_PullMobs then continue
			else if (AA_BringMobsMode) then begin
				//If we are in bringMobsMode, and no mobs to pull, run to group
					AutoFollow;
			end;
		end;
	
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			if CheckUse_HeroSelfBuffs then continue;
		(*	
			//	time to aoe?
			if (IsTime_ToAoe) and (has summon 79) then begin
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					//AOE Pvp
					if (SetTarget_MostClustered_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
		*)	
				if (PvpLoaded) then begin
					//Single Target Pvp
				(*	if setPet then begin
						if 79 summon and summon aoe ready then begin
							check pet mana, range, not dead etc..
							find center target
							use summon aoe on target
							if aoe used, delay(100) and go on to initialize pet attack
						end;
					
						ma := GetTarget_MainAssist;
						if (ma = nil) or (ma = user) or (ma.target = nil) then begin
							if (SetTarget_Best_Pvp) then begin
								//Pet Attack!
								Continue;
							end;
						end else if not(ma.target = nil) then begin
							Engine.CancelTarget();
							Engine.SetTarget(ma.target);
							//Pet Attack! 
							Continue;
						end;
					end else begin
						//If it is not time to attack with pet
						//Do warrior bane
						//Mass surrender to water
					
					end;
					//Attack with pet
						*)
				end else begin
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
				end;
			
			//end;
			
			
		//Non Combat Related
		end else begin
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;


procedure AutoTitan;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Titan Started.');
	while true do begin
		Delay(400);		
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		if CombatEnabled then begin
			if Check_LowHpMode_Actions then continue;
		end;
		
		//if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			//SetPoint_AoePosition;
			if CheckUse_HeroSelfBuffs then continue;
			if Action_CheckForCombatInitiation then continue;
			
			//	time to aoe?		//Dont allow titans to aoe in pvp.
			if (false) and not PvpLoaded then begin
				//Dont allow Titans to Aoe at all for now.
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					if CheckUse_FinalSecret then continue;
					
				
					//AOE Pvp
					if (SetTarget_MostClustered_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
			
				if (PvpLoaded) then begin
					if CheckUse_FinalSecret then continue;
					
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
		
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;



procedure AutoTyrant;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Titan Started.');
	while true do begin
		Delay(400);		
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		
		if (CombatEnabled) then begin
			if Check_LowHpMode_Actions then continue;
		end;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			//SetPoint_AoePosition;
			if CheckUse_HeroSelfBuffs then continue;
			if Action_CheckForCombatInitiation then continue;
			
			//	time to aoe?		//Dont allow titans to aoe in pvp.
			if (false) and not PvpLoaded then begin
				//Dont allow Titans to Aoe at all for now.
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					if CheckUse_FinalSecret then continue;
					
					//AOE Pvp
					if (SetTarget_MostClustered_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
			
				if (PvpLoaded) then begin
				
					if CheckUse_FinalSecret then continue;
				
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
				
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
		
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;



procedure AutoDoombringer;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Doombringer Started.');
	while true do begin
		Delay(400);		
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		if CombatEnabled then begin
			if Check_Trigger_Sos then continue;
		end;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			//SetPoint_AoePosition;
			if CheckUse_HeroSelfBuffs then continue;
			if Action_CheckForCombatInitiation then continue;
			
			//	time to aoe?		//Dont allow titans to aoe in pvp.
			if (false) and not PvpLoaded then begin
				//Dont allow Titans to Aoe at all for now.
				
				//So here we are within 150 range of the aoe point.
				if (PvpLoaded) then begin
					if CheckUse_FinalSecret then continue;
					
					if CheckUse_Doombringer_Pvp_Buff then continue;
					
					//AOE Pvp
					if (SetTarget_MostClustered_Pvp) then
						Continue;
					
				end else begin
					//AOE PVE
					if (SetTarget_MostClustered_Pve) then
						Continue;
				end;
			
			//	if not aoe, then we single target!
			end else begin
			
				if (PvpLoaded) then begin
				
					if CheckUse_FinalSecret then continue;
					if CheckUse_Doombringer_Pvp_Buff then continue;
					
					//Check use Mass Disarm
					if (HasSkill_Ready(794)) then begin
						if (GetCount_DamageDealers_NearChar_Pvp(User, 200) > 4) then begin
							CUseSkill(794, false, false, Engine.GetFaceState(0));
						end;
					end;
					
					//Rush Impact
					if HasSkill_Ready(793) and (User.Mp > 30) and SetTarget_BestToStun_ByRange(350, 600) then begin
						CUseSkill(793, false, false, Engine.GetFaceState(0));
					end;
					
					//Single Target Pvp
					if SetTarget_MainAssist then 
						continue
					else if SetTarget_Best_Pvp then
						continue;
						
				end else begin
				
					
					//Rush Impact
					if HasSkill_Ready(793) and (User.Mp > 60) and SetTarget_BestToStun_ByRange(350, 600) then begin
						Engine.UseSkill(793);
					end;
				
					//Singe Target Pve
					if SetTarget_MainAssist then 
						continue
					else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
						continue
					else if SetTarget_NearestAgroed_Pve then
						continue;
				end;
			
			end;
			
			
		//Non Combat Related
		end else begin
		
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
			
		end;
		AutoFollow();
	end;
end;

procedure AutoDagger;
var
ma : Tl2Char;
oLiveTarget: Tl2Live;
oCharTarget: Tl2Char;
pauseMessageSent: Boolean;
begin
	pauseMessageSent := false;
	Print('Auto Dagger Started.');
	while true do begin
		Delay(400);		
		CheckRemove_BuffsByList;
		
		VoiceCommand_Listen;
		if DoActions or TotalPause or (User.Dead) then begin
			CheckBuffs_L2Idle;
			if not pauseMessageSent then begin
				Print('We are total paused');
				pauseMessageSent := true;
			end;
			Continue;
		end;
		pauseMessageSent := false;
		if CheckBuffs_L2Idle then continue;
		
		PlayersNearby := IsOtherPlayersNearby(3000);
		SetPoint_PartyCenter;
		SetPvpStance;
		if CombatEnabled then begin
			if Check_Trigger_Sos then continue;
		end;
		
		if (DiscreteMode) and (PlayersNearby) then Continue;
		
	
		//	Before anything else, check our distance to party center
		//	As we shouldn't do anything unless party is close
		if CheckPartyDistance then Continue;
		
		//Combat Related
		if (IsUnderAttack) and CombatEnabled then begin
			//SetPoint_AoePosition;
			if CheckUse_HeroSelfBuffs then continue;
			if Action_CheckForCombatInitiation then continue;
			
			if (PvpLoaded) then begin
					
				if CheckUse_Dagger_Pvp_Buff then continue;
					
				//Single Target Pvp
				if SetTarget_MainAssist then 
					continue
				else if SetTarget_Best_Pvp then
					continue;
						
			end else begin
				//Singe Target Pve
				if SetTarget_MainAssist then 
					continue
				else if TargetSearch_LowestFirst and SetTarget_LowestHpAgroed_Pve(650) then
					continue
				else if SetTarget_NearestAgroed_Pve then
					continue;
			end;
			
			
		//Non Combat Related
		end else begin
		
			if CheckMove_DeadParty_LeaderOnly() then continue;
			
		end;
		AutoFollow();
	end;
end;

procedure AutoSpoiler;
var
ma: Tl2Char;
begin
	Print('Auto Spoiler started.');
	while true do begin
		VoiceCommand_Listen;
		DoActions;
		CheckSweep;
		if (CharList.ByName('iNuke', ma)) then begin
		
			if not (ma.Target = nil) 
			and not (ma.Target.Dead)
			and (ma.Target.Attackable) then begin
					engine.SetTarget(ma.Target);
			end else begin
				if (User.DistTo(ma) > 100) then Engine.DMoveTo(ma.x, ma.y, ma.z);
			end;
			
			
		
		end;
		Delay(750);
	end;
end;



function CheckPartyDistance: Boolean;
var
z: Integer;
begin	
	result := false;
	if (PARTY_PT_DIST > MAX_PARTY_PT_DIST) then begin
		LockCheck_MoveAndBot_Off;
		Engine.CancelTarget;
		z := User.Z;
		print('Move to party center at x,y = ' + IntToStr(PT_PX) + ', ' + IntToStr(PT_PY));
		Engine.DMoveTo(PT_PX, PT_PY, z);
		Delay(1250);
		LockCheck_MoveAndBot_On;
		result := true;
	end;
end;

begin
	InitializeVariables;
	SetWeaponEquipped();

	
	if IsClass_Wl(User.ClassID) then AutoWarlord;
	if IsClass_Ol(User.ClassID) then AutoOverlord;
	if IsClass_Nuker(User.ClassID) then AutoNuker;
	if IsClass_Slh(User.ClassID) then AutoSoulHound;
	if IsClass_Tank(User.ClassID) then AutoTank;
	if IsClass_Bp(User.ClassID) then AutoBishop;
	if IsClass_Destro(User.ClassID) then AutoTitan;
	if IsClass_Spoiler(User.ClassID) then AutoSpoiler;
	if IsClass_Dagger(User.ClassID) then AutoDagger;
	if IsClass_Db(User.ClassID) then AutoDoombringer;
	if IsClass_Tyrant(User.ClassID) then AutoTyrant;
	if IsClass_Ee(User.ClassID) then AutoElvenElder;
	if IsClass_Archer(User.ClassID) then AutoArcher;
	if IsClass_SwsBd(User.ClassID) then AutoOffTank_SwsBd;
	if IsClass_Summoner(User.ClassID) then AutoSummoner;
	
	print('Waring, class not recognized, running Voice commands and Actions only');
	while true do begin
		VoiceCommand_Listen;
		DoActions;
		SetPvpStance;
		Delay(750);
	end;
	
	print('Error, script ended!?');
	
end.



