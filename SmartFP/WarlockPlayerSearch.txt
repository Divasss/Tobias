uses
SysUtils;


procedure WtsShout;
begin
	while true do begin
		Engine.Say('WTS Great Sword 10.5 kk - Target me!', 1, '');
		Delay(100);
		Engine.Say('WTS Blue Wolf Gaiters 2.85 kk - Target me!', 1, '');  
		Delay(100);
		Engine.Say('WTS Blue Breastplate Parts 48k each - PM me!', 1, '');  
		Delay(100);
		Engine.Say('WTS SB: WildMagic/Silence/Stigma/Suspension - Target/PM Me!', 1, '');
		Delay(80000);
	end;
end;

function IsKnownWarlock(sName: String): Boolean;
begin
	result := false;
	if (sName = 'Corn')
	or (sName = 'Xtar')
	or (sName = 'OwnedBy')
	or (sName = 'Tpakmop')
	or (sName = 'ajaj')
	or (sName = 'Fireman')
	or (sName = 'PornoActor')
	or (sName = 'Gahena')
	or (sName = 'Pugna') then begin
		result := true;
	end;
end;

function IsName_Exception(sName: String): Boolean;
begin
	result := false;
	if (sName = 'Linker') // lv 52 or 54 cat
	or (sName = 'Iyahuari') // lv 50 cat
	or (sName = 'DaQuel')   //lv 50 cat
	or (sName = 'Maugli')  // cat lv 50
	or (sName = 'Iyahuari') then begin
		result := true;
	end;
end;

function FindPet(masterName: string): Tl2Live;
var
i: Integer;
oTarget: Tl2Live;
begin
	result := user as Tl2Live;
	if (masterName = '') then exit;
	for i := 0 to NpcList.Count - 1 do begin
		oTarget := NpcList.Items(i);
		if (oTarget = nil) or (oTarget.Name = '') then Continue;
		if (oTarget.Title = masterName) then begin
			result := oTarget;
			exit;
		end;	
	end;
end;


var
i: Integer;
oTarget: Tl2Char;
oPet: Tl2Live;
found: Boolean;
begin
	if (User.name = 'Jebus') then 
	  Script.NewThread(@WtsShout);

	Engine.Msg('Event', 'Zariche dropped!', 128);
	  
	while true do delay(123123);
	Engine.EnterText('');
	Print('Searching for other warlocks...');
	PlaySound('D:\\Games\\Lineage 2\\Adrenaline\\Sounds\\msg.wav');
	while true do begin
    found := false;
		for i := 0 to CharList.Count - 1 do begin
			oTarget := CharList.Items(i);
			if (oTarget = nil) or (oTarget.Name = '') or (IsName_Exception(oTarget.Name)) then Continue;
			if (oTarget.ClassId = 14) or (oTarget.ClassId = 96) then begin
				
				if (oTarget.ClassId = 14) then
					print('Warlock found. Name = ' + oTarget.Name)
				else 
					print('Arcana Lord found. Name = ' + oTarget.Name);
				
				if (IsKnownWarlock(oTarget.Name)) then begin
					print('Player is known from ranking list.');
				end;
				
				oPet := FindPet(oTarget.Name);
				if not (oPet = nil) and not (oPet.Name = '') then begin
					print(oTarget.Name + '''s summon found. Name = ' + oPet.Name + '  Level = ' + IntToStr(oPet.Level));
				end;
				print(' --- --- --- --- --- --- --- --- --- ');
				Engine.CancelTarget();
				Engine.SetTarget(oTarget);
				//PlaySound('D:\\Games\\Lineage 2\\Adrenaline\\Sounds\\msg.wav');
				Engine.BlinkWindow(true);
				Delay(300);
				Engine.EnterText('/olympiadstat');
				found := true;
				Delay(2000);
			end;
		end;
    if found then delay(3000);

		Delay(3000);
	end;
end.